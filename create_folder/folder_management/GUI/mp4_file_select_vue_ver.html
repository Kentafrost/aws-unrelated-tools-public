<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select files with specific tags - Vue Version</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 20px;
        }
        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        select, input[type="text"], button {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            cursor: pointer;
            color: white;
        }
        .btn-primary { background-color: #007bff; }
        .btn-success { background-color: #28a745; }
        .btn-info { background-color: #17a2b8; }
        .btn-secondary { background-color: #6c757d; }
        .btn-warning { background-color: #ffc107; color: black; }
        #file-list {
            border: 1px solid #ddd;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <div class="file-manager container">
    <h3>ğŸ¬ MP4 File Manager</h3>
    
    <div class="controls">
        <label>ğŸ·ï¸ ã‚¿ã‚°ã‚’é¸æŠ:</label>
        <select v-model="selectedTag" id="tag-item" name="tag">
            <option value="">ğŸ—‚ï¸ ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ« (All Files)</option>
            <option v-for="tag in tags" :key="tag" :value="tag">{{ tag }}</option>
        </select>

        <input v-model="searchQuery" id="search-input" placeholder="ğŸ” ãƒ•ã‚¡ã‚¤ãƒ«åã§æ¤œç´¢...">

        <button @click="selectfolder" class="btn-primary">ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ</button>
        <button @click="refreshData" class="btn-success">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­è¾¼</button>
        <button @click="json_tag_selection" class="btn-info">ğŸ·ï¸ ã‚¿ã‚°æ›´æ–°</button>
        <button @click="debugEnvironment" class="btn-secondary">ğŸ› ãƒ‡ãƒãƒƒã‚°</button>
        <button @click="checkFileExistence" class="btn-warning">ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª</button>
    </div>

    <div id="selected-folder-path">
        é¸æŠã•ã‚ŒãŸãƒ•ã‚©ãƒ«ãƒ€ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ (Selected folder will be displayed here)
    </div>

    <div id="file-list">
        <div v-if="loading">ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­... (Loading data...)</div>
        <div v-else-if="filteredFiles.length === 0">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (No files found)</div>
        <div v-else>
            <div v-for="file in filteredFiles" :key="file.name" style="padding: 5px; border-bottom: 1px solid #eee;">
                <strong>ğŸ“„ {{ file.name }}</strong>
                <div v-if="file.tags && file.tags.length > 0" style="margin-top: 3px;">
                    <span v-for="tag in file.tags" :key="tag" 
                          style="background-color: #e9ecef; padding: 2px 6px; margin: 2px; border-radius: 3px; font-size: 0.8em;">
                        ğŸ·ï¸ {{ tag }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <script src="javascript/retrieve_folder_data.js"></script>
    <script src="javascript/folder_name_to_json.js"></script>
    
    <script>
        // Vue.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
        new Vue({
            el: '.file-manager',
            data: {
                selectedTag: '',
                searchQuery: '',
                tags: [],
                files: [],
                filteredFiles: [],
                loading: false
            },
            computed: {
                // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ
                filteredFiles() {
                    let filtered = this.files;
                    
                    // ã‚¿ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                    if (this.selectedTag) {
                        filtered = filtered.filter(file => 
                            file.tags && file.tags.includes(this.selectedTag)
                        );
                    }
                    
                    // æ¤œç´¢ã‚¯ã‚¨ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                    if (this.searchQuery) {
                        filtered = filtered.filter(file => 
                            file.name.toLowerCase().includes(this.searchQuery.toLowerCase())
                        );
                    }
                    
                    return filtered;
                }
            },
            methods: {
                // ãƒ•ã‚©ãƒ«ãƒ€é¸æŠ
                selectfolder() {
                    console.log('ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠ');
                    if (typeof window.selectfolder === 'function') {
                        window.selectfolder();
                    }
                },
                
                // ãƒ‡ãƒ¼ã‚¿å†èª­è¾¼
                refreshData() {
                    console.log('ãƒ‡ãƒ¼ã‚¿ã‚’å†èª­è¾¼');
                    this.loading = true;
                    // æ—¢å­˜ã®é–¢æ•°ãŒã‚ã‚Œã°å‘¼ã³å‡ºã—
                    if (typeof window.refreshData === 'function') {
                        window.refreshData();
                    }
                    setTimeout(() => {
                        this.loading = false;
                    }, 1000);
                },
                
                // ã‚¿ã‚°æ›´æ–°
                json_tag_selection() {
                    console.log('ã‚¿ã‚°æ›´æ–°');
                    // æ­£ã—ã„é–¢æ•°åã§å‘¼ã³å‡ºã—
                    if (typeof window.json_tag_selection === 'function') {
                        window.json_tag_selection();
                        alert('ã‚¿ã‚°ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ');
                    } else {
                        console.log('json_tag_selectioné–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                },
                
                // ãƒ‡ãƒãƒƒã‚°
                debugEnvironment() {
                    if (typeof window.debugEnvironment === 'function') {
                        window.debugEnvironment();
                    } else {
                        console.log('debugEnvironmenté–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                },
                
                // ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
                checkFileExistence() {
                    console.log('ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª');
                    // æ—¢å­˜ã®file_data_to_jsoné–¢æ•°ãŒã‚ã‚Œã°å‘¼ã³å‡ºã—
                    if (typeof window.checkFileExistence === 'function') {
                        window.checkFileExistence();
                        alert('ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸ');
                    } else {
                        console.log('checkFileExistenceé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                },                
            },
            
            mounted() {
                // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸæ™‚ã«å®Ÿè¡Œ
                console.log('Vue.js ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã—ãŸ');
                
                // æ—¢å­˜ã®åˆæœŸåŒ–é–¢æ•°ãŒã‚ã‚Œã°å‘¼ã³å‡ºã—
                if (typeof window.json_data_list === 'function') {
                    window.json_data_list();
                }
                if (typeof window.initializeEventListeners === 'function') {
                    window.initializeEventListeners();
                }
                if (typeof window.json_tag_selection === 'function') {
                    window.json_tag_selection();    
                }
                if (typeof window.file_data_to_json === 'function') {
                    window.file_data_to_json();
                } else {
                    // æ—¢å­˜ã®é–¢æ•°ãŒãªã„å ´åˆã¯ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
                    this.loadData();
                }
            }
        });
    </script>

</body>
</html>

